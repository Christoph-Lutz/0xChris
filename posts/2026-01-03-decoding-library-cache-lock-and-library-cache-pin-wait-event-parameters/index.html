<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Decoding Library Cache Lock and Library Cache Pin Wait Event Parameters | 0xChris</title>

    
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <link rel="stylesheet" href="/css/custom.css" />

    
    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Decoding Library Cache Lock and Library Cache Pin Wait Event Parameters">
  <meta name="twitter:description" content="Oracle wait events provide additional context information through their P1, P2, and P3 parameters, but unfortunately, the documentation for many wait events is incomplete or outdated.
If you’ve ever had to troubleshoot library cache contention, you have likely encountered the wait events “library cache lock”, “library cache load lock”, and “library cache pin”. They are described in various My Oracle Support notes, such as 1, 2, and 3, and their parameters, according to these docs, are as follows:">


<meta property="og:title" content="Decoding Library Cache Lock and Library Cache Pin Wait Event Parameters">
<meta property="og:description" content="Oracle wait events provide additional context information through their P1, P2, and P3 parameters, but unfortunately, the documentation for many wait events is incomplete or outdated.
If you&amp;amp;rsquo;ve ever had to troubleshoot library cache contention, you have likely encountered the wait events &amp;amp;ldquo;library cache lock&amp;amp;rdquo;, &amp;amp;ldquo;library cache load lock&amp;amp;rdquo;, and &amp;amp;ldquo;library cache pin&amp;amp;rdquo;. They are described in various My Oracle Support notes, such as 1, 2, and 3, and their parameters, according to these docs, are as follows:
">
<meta property="og:url" content="https://www.0xChris.dev/posts/2026-01-03-decoding-library-cache-lock-and-library-cache-pin-wait-event-parameters/">
<meta property="og:type" content="article">
<meta property="og:site_name" content="0xChris">



<meta property="og:image" content="https://www.0xChris.dev/">


  </head>

  <body>
    <nav>
      <ul class="menu">
        
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/posts/">Blog</a></li>
        
          <li><a href="/categories/">Categories</a></li>
        
          <li><a href="/tags/">Tags</a></li>
        
          <li><a href="/contact/">Contact</a></li>
        
          <li><a href="/index.xml">Subscribe</a></li>
        

        
        
          
            <li class="icon">
              <a href="https://github.com/Christoph-Lutz" aria-label="GitHub">
                
                <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
  <title>GitHub</title>
  <path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12" fill="currentColor"/>
</svg>

              </a>
            </li>
          
            <li class="icon">
              <a href="https://x.com/chris_skyflier" aria-label="Twitter">
                
                <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>X</title><path d="M14.234 10.162 22.977 0h-2.072l-7.591 8.824L7.251 0H.258l9.168 13.343L.258 24H2.33l8.016-9.318L16.749 24h6.993zm-2.837 3.299-.929-1.329L3.076 1.56h3.182l5.965 8.532.929 1.329 7.754 11.09h-3.182z"/></svg>
              </a>
            </li>
          
            <li class="icon">
              <a href="https://bsky.app/profile/christophlutz.bsky.social" aria-label="Bluesky">
                
                <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Bluesky</title><path d="M5.202 2.857C7.954 4.922 10.913 9.11 12 11.358c1.087-2.247 4.046-6.436 6.798-8.501C20.783 1.366 24 .213 24 3.883c0 .732-.42 6.156-.667 7.037-.856 3.061-3.978 3.842-6.755 3.37 4.854.826 6.089 3.562 3.422 6.299-5.065 5.196-7.28-1.304-7.847-2.97-.104-.305-.152-.448-.153-.327 0-.121-.05.022-.153.327-.568 1.666-2.782 8.166-7.847 2.97-2.667-2.737-1.432-5.473 3.422-6.3-2.777.473-5.899-.308-6.755-3.369C.42 10.04 0 4.615 0 3.883c0-3.67 3.217-2.517 5.202-1.026"/></svg>
              </a>
            </li>
          
            <li class="icon">
              <a href="https://sym42.org" aria-label="Sym42">
                
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
  <path transform="scale(0.1004,0.1364) translate(11,1)" d="M0 0 C8.91 0 17.82 0 27 0 C27 32.01 27 64.02 27 97 C51.75 97 76.5 97 102 97 C102.33 118.78 102.66 140.56 103 163 C113.65023618 149.38741342 113.65023618 149.38741342 124 135.5625 C125.16793211 133.96872315 126.33590197 132.37497396 127.50390625 130.78125 C128.08156738 129.99105469 128.65922852 129.20085937 129.25439453 128.38671875 C132.14116363 124.43971809 135.0386119 120.50060445 137.9375 116.5625 C138.50952148 115.78430908 139.08154297 115.00611816 139.67089844 114.2043457 C143.34771065 109.21167043 147.06937462 104.25523259 150.81298828 99.3125 C170.98641999 74.34600723 170.98641999 74.34600723 177 44 C175.18481682 37.01549082 172.39314724 31.88945254 166.25390625 27.8515625 C158.52779633 23.46773353 150.43585329 23.37053009 141.8828125 25.125 C137.49428572 26.45701897 133.56042734 28.49182265 129.53125 30.66015625 C127 32 127 32 124 33 C124 23.76 124 14.52 124 5 C138.64493558 -0.63266753 138.64493558 -0.63266753 144.8828125 -0.62890625 C145.54860321 -0.63131821 146.21439392 -0.63373016 146.90036011 -0.63621521 C148.28308171 -0.63525162 149.66584937 -0.62222324 151.04833984 -0.59692383 C153.13124785 -0.56239643 155.20993568 -0.57639315 157.29296875 -0.59570312 C171.18361481 -0.58191047 181.8308422 3.34041929 192.00390625 12.87890625 C200.75379996 22.23354424 204.74719368 34.28009799 205.375 47 C204.41179837 64.52286038 196.17302926 80.08711875 186 94 C185.50757813 94.67724121 185.01515625 95.35448242 184.5078125 96.05224609 C180.97969681 100.89390965 177.41603046 105.70856193 173.84228516 110.51660156 C171.48040306 113.70041612 169.13374187 116.89527097 166.78710938 120.09033203 C159.52624187 129.97226581 152.18066843 139.78923387 144.81054688 149.58984375 C143.01140967 151.98481172 141.21597581 154.38250747 139.421875 156.78125 C138.8645166 157.52608643 138.3071582 158.27092285 137.73291016 159.03833008 C136.68515004 160.43879049 135.6379229 161.83964987 134.59130859 163.2409668 C131.11186653 167.88813347 131.11186653 167.88813347 130 169 C128.28134591 169.0935919 126.55884256 169.11744611 124.83764648 169.11352539 C123.73658066 169.11344986 122.63551483 169.11337433 121.50108337 169.11329651 C120.3031868 169.10813522 119.10529022 169.10297394 117.87109375 169.09765625 C116.65172623 169.0962413 115.4323587 169.09482635 114.17604065 169.09336853 C110.2631693 169.08774967 106.35035419 169.07519396 102.4375 169.0625 C99.79231853 169.05748743 97.14713617 169.0529241 94.50195312 169.04882812 C88.00126274 169.03862296 81.50069467 169.01905121 75 169 C75 154.15 75 139.3 75 124 C50.25 124 25.5 124 0 124 C0 83.08 0 42.16 0 0 Z"/>
  
  <path transform="scale(0.1004,0.1364) translate(155.8828125,0.37109375)" d="M0 0 C0.66579071 -0.00241196 1.33158142 -0.00482391 2.01754761 -0.00730896 C3.40026921 -0.00634537 4.78303687 0.00668301 6.16552734 0.03198242 C8.24843535 0.06650982 10.32712318 0.0525131 12.41015625 0.03320312 C26.30080231 0.04699578 36.9480297 3.96932554 47.12109375 13.5078125 C55.87098746 22.86245049 59.86438118 34.90900424 60.4921875 47.62890625 C59.52898587 65.15176663 51.29021676 80.716025 41.1171875 94.62890625 C40.62476563 95.30614746 40.13234375 95.98338867 39.625 96.68115234 C36.09688431 101.5228159 32.53321796 106.33746818 28.95947266 111.14550781 C26.59759056 114.32932237 24.25092937 117.52417722 21.90429688 120.71923828 C14.64342937 130.60117206 7.29785593 140.41814012 -0.07226562 150.21875 C-1.87140283 152.61371797 -3.66683669 155.01141372 -5.4609375 157.41015625 C-6.2969751 158.52741089 -6.2969751 158.52741089 -7.14990234 159.66723633 C-8.19766246 161.06769674 -9.2448896 162.46855612 -10.29150391 163.86987305 C-13.77094597 168.51703972 -13.77094597 168.51703972 -14.8828125 169.62890625 C-17.02840077 169.7166623 -19.17685671 169.73585844 -21.32421875 169.7265625 C-22.62939453 169.72333984 -23.93457031 169.72011719 -25.27929688 169.71679688 C-26.6679694 169.70844026 -28.05664127 169.6999753 -29.4453125 169.69140625 C-30.83788906 169.68639291 -32.23046731 169.68182972 -33.62304688 169.67773438 C-37.0430112 169.66590059 -40.46289094 169.64941505 -43.8828125 169.62890625 C-43.27097081 166.41918652 -42.20356776 164.38991326 -40.25 161.78515625 C-39.69892578 161.04394531 -39.14785156 160.30273438 -38.58007812 159.5390625 C-37.97873047 158.74371094 -37.37738281 157.94835937 -36.7578125 157.12890625 C-35.82098633 155.87400391 -35.82098633 155.87400391 -34.86523438 154.59375 C-32.87737817 151.93402615 -30.8807052 149.28109666 -28.8828125 146.62890625 C-27.62458729 144.95213253 -26.3667668 143.27505503 -25.109375 141.59765625 C-23.23806447 139.10192152 -21.36611031 136.60668841 -19.49169922 134.11328125 C-14.67303275 127.70001086 -9.90631899 121.24999876 -5.16113281 114.78222656 C-1.50429727 109.80538271 2.1987027 104.86635957 5.92797852 99.94360352 C26.10348636 74.9765367 26.10348636 74.9765367 32.1171875 44.62890625 C30.30200432 37.64439707 27.51033474 32.51835879 21.37109375 28.48046875 C13.64498383 24.09663978 5.55304079 23.99943634 -3 25.75390625 C-7.38852678 27.08592522 -11.32238516 29.1207289 -15.3515625 31.2890625 C-17.8828125 32.62890625 -17.8828125 32.62890625 -20.8828125 33.62890625 C-20.8828125 24.38890625 -20.8828125 15.14890625 -20.8828125 5.62890625 C-6.23787692 -0.00376128 -6.23787692 -0.00376128 0 0 Z"/>
  
  <path transform="scale(0.1004,0.1364) translate(171,143)" d="M0 0 C15.51 0 31.02 0 47 0 C47 8.91 47 17.82 47 27 C31.49 27 15.98 27 0 27 C0 18.09 0 9.18 0 0 Z"/>
  
  <path transform="scale(0.1004,0.1364) translate(135,6)" d="M0 0 C0.99 0.495 0.99 0.495 2 1 C1.67 8.92 1.34 16.84 1 25 C1.66 25 2.32 25 3 25 C2.67 25.99 2.34 26.98 2 28 C1.34 28 0.68 28 0 28 C0 18.76 0 9.52 0 0 Z"/>
</svg>

              </a>
            </li>
          
        
      </ul>
      <hr/>
    </nav>
  </body>
</html>
<div class="article-meta">
<h1><span class="title">Decoding Library Cache Lock and Library Cache Pin Wait Event Parameters</span></h1>

<h2 class="date">2026/01/03</h2>
</div>

<main>
<p>Oracle wait events provide additional context information through their P1, P2, and P3 parameters, but unfortunately, the documentation for many wait events is incomplete or outdated.</p>
<p>If you&rsquo;ve ever had to troubleshoot library cache contention, you have likely encountered the wait events &ldquo;library cache lock&rdquo;, &ldquo;library cache load lock&rdquo;, and &ldquo;library cache pin&rdquo;. They are described in various My Oracle Support notes, such as <a href="https://support.oracle.com/ic/builder/rt/customer_portal/live/webApps/customer-portal/?anchorId=&amp;documentId=KB830534&amp;page=sptemplate&amp;sptemplate=km-article">1</a>, <a href="https://support.oracle.com/ic/builder/rt/customer_portal/live/webApps/customer-portal/?anchorId=&amp;documentId=KB327915&amp;page=sptemplate&amp;sptemplate=km-article">2</a>, and <a href="https://support.oracle.com/ic/builder/rt/customer_portal/live/webApps/customer-portal/?anchorId=&amp;documentId=KB142997&amp;page=sptemplate&amp;sptemplate=km-article">3</a>, and their parameters, according to these docs, are as follows:</p>
<ul>
<li>P1 — handle address (library cache lock and library cache pin) or object address (library cache load lock)</li>
<li>P2 — lock address or pin address</li>
<li>P3 — 100*Mode + Namespace</li>
</ul>
<p>While the information for parameters P1 and P2 is correct, the description of parameter P3 is outdated. This is also explicitly mentioned in My Oracle Support note KB830534 (see <a href="https://support.oracle.com/ic/builder/rt/customer_portal/live/webApps/customer-portal/?anchorId=&amp;documentId=KB830534&amp;page=sptemplate&amp;sptemplate=km-article">1</a>), which states:</p>
<figure style="display:block; width:100%; margin:0; padding:0; box-sizing:border-box;">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>The parameter changed starting with version 11.2 and onward. 
</span></span><span style="display:flex;"><span>This document and the P3 description will be updated when 
</span></span><span style="display:flex;"><span>new information is available.</span></span></code></pre></div>
<figcaption>Listing 1: Excerpt My Oracle Support note KB830534</figcaption>
</figure>
<p>Well, the promised update has apparently been waiting patiently ever since &hellip; but interestingly, the descriptions in <code>v$event_name</code> have been updated to reflect the meaning of the P3 parameter:</p>
<figure style="display:block; width:100%; margin:0; padding:0; box-sizing:border-box;">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>SQL&gt; select name, parameter3 from v$event_name 
</span></span><span style="display:flex;"><span>     where name in (&#39;library cache lock&#39;, &#39;library cache load lock&#39;, &#39;library cache pin&#39;);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NAME                       PARAMETER3
</span></span><span style="display:flex;"><span>-------------------------- --------------------------------------
</span></span><span style="display:flex;"><span>library cache pin          (identifier&lt;&lt;32)+(namespace&lt;&lt;16)+mode
</span></span><span style="display:flex;"><span>library cache lock         (identifier&lt;&lt;32)+(namespace&lt;&lt;16)+mode
</span></span><span style="display:flex;"><span>library cache load lock    (identifier&lt;&lt;32)+(namespace&lt;&lt;16)+mode</span></span></code></pre></div>
<figcaption>Listing 2: P3 wait event description from v$event_name</figcaption>
</figure>
<p>The C-like notation is a little terse, but it provides a compact and precise way to represent the P3 encoding, which is:</p>
<ul>
<li><code>idn &lt;&lt; 32</code> — shift <code>idn</code> into the upper 32 bits of the P3 value</li>
<li><code>namespace &lt;&lt; 16</code> — shift <code>namespace</code> into the middle 16 bits</li>
<li><code>mode</code> — shift <code>mode</code> into the lowest 16 bits</li>
</ul>
<p>This essentially means that the P3 wait event parameter is a 64-bit (8-byte) integer value that encodes the following information (from most significant to least significant position):</p>
<ul>
<li>4 bytes (<code>IIII</code>) — handle identifier</li>
<li>2 bytes (<code>NN</code>) — namespace</li>
<li>2 bytes (<code>MM</code>) — requested lock mode</li>
</ul>
<p>To give a short example:</p>
<figure style="display:block; width:100%; margin:0; padding:0; box-sizing:border-box;">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>P3 decimal: 558075165605890
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>P3 hex: 0x0001fb9100010002
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>P3 hex formatted (IIII NN MM): 0x0001fb91 0001 0002
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>idn: 0x0001fb91 = 129937
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>namespace: 0x0001 = 1 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mode: 0x0002 = 2</span></span></code></pre></div>
<figcaption>Listing 3: Decoding the P3 wait event parameter</figcaption>
</figure>
<p>Using this encoding, the following bitmasks extract the <code>idn</code>, <code>namespace</code>, and <code>mode</code> fields from the P3 value:</p>
<ul>
<li><code>idn</code> (upper 32 bits) — <code>(P3 &amp; 0xFFFFFFFF00000000) &gt;&gt; 32</code></li>
<li><code>namespace</code> (middle 16 bits) — <code>(P3 &amp; 0x00000000FFFF0000) &gt;&gt; 16</code></li>
<li><code>mode</code> (lower 16 bits) — <code>P3 &amp; 0x000000000000FFFF</code></li>
</ul>
<p>The same extraction can be done in <a href="https://github.com/Christoph-Lutz/oracle/blob/main/sql/kgl-lock-pin-p3.sql">SQL</a> as shown below. Oracle SQL doesn’t have a right shift operator, so when bits are extracted using <code>bitand()</code>, they remain in their original positions within the 64-bit number. Without moving them down, the numeric value doesn’t make sense, which is why dividing by <code>power(2, n)</code> is used to shift the bits to the least significant position, effectively performing a right shift:</p>
<figure style="display:block; width:100%; margin:0; padding:0; box-sizing:border-box;">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>define<span style="color:#bbb"> </span>p3<span style="color:#666">=</span><span style="color:#666">558075165605890</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">select</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>bitand(<span style="color:#666">&amp;</span>p3,<span style="color:#bbb"> </span>to_number(<span style="color:#b44">&#39;ffffffff00000000&#39;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#39;xxxxxxxxxxxxxxxx&#39;</span>))<span style="color:#bbb"> </span><span style="color:#666">/</span><span style="color:#bbb"> </span>power(<span style="color:#666">2</span>,<span style="color:#bbb"> </span><span style="color:#666">32</span>)<span style="color:#bbb"> </span>idn,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>bitand(<span style="color:#666">&amp;</span>p3,<span style="color:#bbb"> </span>to_number(<span style="color:#b44">&#39;00000000ffff0000&#39;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#39;xxxxxxxxxxxxxxxx&#39;</span>))<span style="color:#bbb"> </span><span style="color:#666">/</span><span style="color:#bbb"> </span>power(<span style="color:#666">2</span>,<span style="color:#bbb"> </span><span style="color:#666">16</span>)<span style="color:#bbb"> </span>namespace,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>bitand(<span style="color:#666">&amp;</span>p3,<span style="color:#bbb"> </span>to_number(<span style="color:#b44">&#39;000000000000ffff&#39;</span>,<span style="color:#bbb"> </span><span style="color:#b44">&#39;xxxxxxxxxxxxxxxx&#39;</span>))<span style="color:#bbb"> </span>lmode<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">from</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>dual<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">/</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">       </span>IDN<span style="color:#bbb">  </span>NAMESPACE<span style="color:#bbb">      </span>LMODE<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#080;font-style:italic">---------- ---------- ----------
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span><span style="color:#bbb">    </span><span style="color:#666">129937</span><span style="color:#bbb">          </span><span style="color:#666">1</span><span style="color:#bbb">          </span><span style="color:#666">2</span></span></span></code></pre></div>
<figcaption>Listing 4: Extracting idn, namespace, and mode from P3 using SQL</figcaption>
</figure>
<p>The SQL expressions for decoding the P3 value are particularly useful for troubleshooting, as they can be used to analyze the Active Session History (ASH). For instance, the following query analyzes library cache lock waits over the last minute by session id, sql_id, and requested lock mode, showing how many seconds each session spent waiting (db time):</p>
<figure style="display:block; width:100%; margin:0; padding:0; box-sizing:border-box;">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">select</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>session_id,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>sql_id,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>event,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>bitand(p3,<span style="color:#bbb"> </span>to_number(<span style="color:#b44">&#39;000000000000ffff&#39;</span>,<span style="color:#b44">&#39;xxxxxxxxxxxxxxxx&#39;</span>))<span style="color:#bbb"> </span>lmode,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">sum</span>(<span style="color:#666">1</span>)<span style="color:#bbb"> </span>dbtime<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">from</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>v$active_session_history<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">where</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>sample_time<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">between</span><span style="color:#bbb"> </span>systimestamp<span style="color:#666">-</span><span style="color:#666">1</span><span style="color:#666">/</span><span style="color:#666">1440</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">and</span><span style="color:#bbb"> </span>systimestamp<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">and</span><span style="color:#bbb"> </span>event<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span><span style="color:#b44">&#39;library cache lock&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">group</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">by</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>session_id,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>sql_id,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>event,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>bitand(p3,<span style="color:#bbb"> </span>to_number(<span style="color:#b44">&#39;000000000000ffff&#39;</span>,<span style="color:#b44">&#39;xxxxxxxxxxxxxxxx&#39;</span>))<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">/</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>SESSION_ID<span style="color:#bbb"> </span>SQL_ID<span style="color:#bbb">        </span>EVENT<span style="color:#bbb">                     </span>LMODE<span style="color:#bbb">     </span>DBTIME<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#080;font-style:italic">---------- ------------- -------------------- ---------- ----------
</span></span></span><span style="display:flex;"><span><span style="color:#080;font-style:italic"></span><span style="color:#bbb">        </span><span style="color:#666">29</span><span style="color:#bbb"> </span><span style="color:#666">5</span>bc0v4my7dvr5<span style="color:#bbb"> </span>library<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">cache</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">lock</span><span style="color:#bbb">            </span><span style="color:#666">2</span><span style="color:#bbb">         </span><span style="color:#666">45</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#666">1076</span><span style="color:#bbb"> </span><span style="color:#666">9</span>m6gaxr884xqq<span style="color:#bbb"> </span>library<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">cache</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">lock</span><span style="color:#bbb">            </span><span style="color:#666">2</span><span style="color:#bbb">         </span><span style="color:#666">39</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#666">1250</span><span style="color:#bbb"> </span><span style="color:#666">7</span>bwbtvf589tu8<span style="color:#bbb"> </span>library<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">cache</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">lock</span><span style="color:#bbb">            </span><span style="color:#666">2</span><span style="color:#bbb">         </span><span style="color:#666">34</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>...</span></span></code></pre></div>
<figcaption>Listing 5: Using SQL expressions to decode the P3 parameter in ASH</figcaption>
</figure>
<p>The SQL expressions can also be used with Tanel Poder’s <code>ashtop.sql</code> and <code>dashtop.sql</code> scripts (see <a href="https://github.com/tanelpoder/tpt-oracle">4</a>), although the syntax isn’t particularly elegant, and the sqlplus column formatting can get a bit hacky when using proper column aliases (ensure the SQL expressions have no extra whitespace when using them with ashtop):</p>
<figure style="display:block; width:100%; margin:0; padding:0; box-sizing:border-box;">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#a2f;font-weight:bold">SQL</span><span style="color:#666">&gt;</span><span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">column</span><span style="color:#bbb"> </span>bitand(p3,to_number(<span style="color:#b44">&#39;000000000000ffff&#39;</span>,<span style="color:#b44">&#39;xxxxxxxxxxxxxxxx&#39;</span>))<span style="color:#bbb"> </span>heading<span style="color:#bbb"> </span>LMODE<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">SQL</span><span style="color:#666">&gt;</span><span style="color:#bbb"> </span><span style="color:#666">@</span>ashtop.<span style="color:#a2f;font-weight:bold">sql</span><span style="color:#bbb"> </span><span style="color:#b44">&#34;sid,event2,bitand(p3, to_number(&#39;000000000000ffff&#39;,&#39;xxxxxxxxxxxxxxxx&#39;))&#34;</span><span style="color:#bbb"> </span><span style="color:#b44">&#34;event=&#39;library cache lock&#39;&#34;</span><span style="color:#bbb"> </span><span style="color:#b44">&#34;systimestamp-(1/1440)&#34;</span><span style="color:#bbb"> </span><span style="color:#b44">&#34;systimestamp&#34;</span></span></span></code></pre></div>
<figcaption>Listing 6: Using ashtop to decode the P3 parameter</figcaption>
</figure>
<p>When you know the identifier (<code>idn</code>), you can use it to lookup additional details in <code>v$db_object_cache</code> (provided that the object is still cached in the library cache):</p>
<figure style="display:block; width:100%; margin:0; padding:0; box-sizing:border-box;">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>define<span style="color:#bbb"> </span>idn<span style="color:#666">=</span><span style="color:#666">129937</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">select</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>hash_value,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>name,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>namespace,<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">type</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>locks,<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>pins,<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>locked_total,<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>pinned_total<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">from</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>v$db_object_cache<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">where</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>hash_value<span style="color:#bbb"> </span><span style="color:#a2f;font-weight:bold">in</span><span style="color:#bbb"> </span>(<span style="color:#666">&amp;</span>idn)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">/</span></span></span></code></pre></div>
<figcaption>Listing 7: Looking up library cache object details by idn</figcaption>
</figure>
<p>The numeric library cache namespace IDs can be converted to textual descriptions with a query such as the one below:</p>
<figure style="display:block; width:100%; margin:0; padding:0; box-sizing:border-box;">
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>define<span style="color:#bbb"> </span>namespace_id<span style="color:#666">=</span><span style="color:#666">1</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">select</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>indx,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>kglstdsc<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">from</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>x$kglst<span style="color:#bbb">  
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a2f;font-weight:bold">where</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>kglsttyp<span style="color:#666">=</span><span style="color:#b44">&#39;NAMESPACE&#39;</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#a2f;font-weight:bold">and</span><span style="color:#bbb"> </span>indx<span style="color:#666">=&amp;</span>namespace_id<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">/</span></span></span></code></pre></div>
<figcaption>Listing 8: Looking up namespace by id</figcaption>
</figure>
<p>Finally, according to My Oracle Support note KB830534 (see <a href="https://support.oracle.com/ic/builder/rt/customer_portal/live/webApps/customer-portal/?anchorId=&amp;documentId=KB830534&amp;page=sptemplate&amp;sptemplate=km-article">1</a>), the library cache lock and pin modes, along with their compatibility matrix, are as follows (KGL = Kernel Generic Library Cache):</p>
<figure style="text-align: center; margin: 0 auto;">
  <img src="/images/kgl-lock-pin-modes-matrix.png" 
    alt="Library cache lock and pin modes with compatibility matrix" 
     style="width: 80%; height: auto; display: block; margin-bottom: 0.6em;">
  <figcaption>
    Figure 1: Library cache lock and pin modes with compatibility matrix (modified from source <a href="https://support.oracle.com/ic/builder/rt/customer_portal/live/webApps/customer-portal/?anchorId=&documentId=KB830534&page=sptemplate&sptemplate=km-article" target="_blank">1</a>)
  </figcaption>
</figure>
<h3 id="references">References</h3>
<p>[1] <a href="https://support.oracle.com/ic/builder/rt/customer_portal/live/webApps/customer-portal/?anchorId=&amp;documentId=KB830534&amp;page=sptemplate&amp;sptemplate=km-article">My Oracle Support, WAITEVENT: &ldquo;library cache lock&rdquo; Reference Note (KB830534), 2025-11-28</a><br>
[2] <a href="https://support.oracle.com/ic/builder/rt/customer_portal/live/webApps/customer-portal/?anchorId=&amp;documentId=KB327915&amp;page=sptemplate&amp;sptemplate=km-article">My Oracle Support, WAITEVENT: &ldquo;library cache pin&rdquo; Reference Note (KB327915), 2025-11-30</a><br>
[3] <a href="https://support.oracle.com/ic/builder/rt/customer_portal/live/webApps/customer-portal/?anchorId=&amp;documentId=KB142997&amp;page=sptemplate&amp;sptemplate=km-article">My Oracle Support, Troubleshooting Library Cache: Lock, Pin and Load Lock (KB142997), 2025-11-28</a><br>
[4] <a href="https://github.com/tanelpoder/tpt-oracle">Tanel Poder, tpt-oracle GitHub Repository, 2025-11-13</a></p>

</main>

  <footer>
  
  <hr/>
  © <a href="https://www.0xChris.dev">Christoph Lutz</a> 2025 &ndash; 2026
  
  <hr/>
  <script src="https://giscus.app/client.js"
            data-repo="Christoph-Lutz/0xChris-Comments"
            data-repo-id="R_kgDOQo-jcg"
            data-category="Comments"
            data-category-id="DIC_kwDOQo-jcs4Cz0NV"
            data-mapping="pathname"
            data-strict="1"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="bottom"
            data-theme="light"
            data-lang="en"
            crossorigin="anonymous"
            async>
        </script>
    <script id="partials/analytics.html" 
  data-goatcounter="https://0xchris.goatcounter.com/count"
  async src="//gc.zgo.at/count.js"></script>

  </footer>
  </body>
</html>

